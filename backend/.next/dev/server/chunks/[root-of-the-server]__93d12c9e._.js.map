{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/IMAGE%20EDITOR/Image_Editor/backend/lib/cloudinary.ts"],"sourcesContent":["import { v2 as cloudinary } from 'cloudinary';\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET\n});\n\nexport default cloudinary;\n\n// Helper function to create folder structure in Cloudinary\nexport async function createCloudinaryFolder(folderPath: string) {\n  // Cloudinary creates folders automatically when you upload to them\n  // We'll upload a small transparent 1x1 PNG placeholder\n  const placeholderImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';\n  \n  try {\n    const result = await cloudinary.uploader.upload(placeholderImage, {\n      folder: folderPath,\n      public_id: '.folder_marker',\n      overwrite: true,\n      invalidate: true,\n      resource_type: 'image'\n    });\n    return { success: true, public_id: result.public_id };\n  } catch (error: any) {\n    console.error(`Error creating folder ${folderPath}:`, error);\n    return { success: false, error: error.message };\n  }\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,uBAAuB;AACvB,mHAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;uCAEe,mHAAU;AAGlB,eAAe,uBAAuB,UAAkB;IAC7D,mEAAmE;IACnE,uDAAuD;IACvD,MAAM,mBAAmB;IAEzB,IAAI;QACF,MAAM,SAAS,MAAM,mHAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,kBAAkB;YAChE,QAAQ;YACR,WAAW;YACX,WAAW;YACX,YAAY;YACZ,eAAe;QACjB;QACA,OAAO;YAAE,SAAS;YAAM,WAAW,OAAO,SAAS;QAAC;IACtD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,WAAW,CAAC,CAAC,EAAE;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;AACF","debugId":null}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/IMAGE%20EDITOR/Image_Editor/backend/pages/api/organization/%5BorgName%5D/images.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport cloudinary from '@/lib/cloudinary';\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'GET') {\n    res.setHeader('Allow', ['GET']);\n    return res.status(405).end(`Method ${req.method} Not Allowed`);\n  }\n\n  try {\n    const { orgName } = req.query;\n    const { type } = req.query; // 'editor' or 'mindmapping'\n    \n    if (!orgName || typeof orgName !== 'string') {\n      return res.status(400).json({ error: 'Organization name is required' });\n    }\n    \n    // Search for images in the organization folder\n    // If type is specified, look in subfolder\n    const folderPath = type ? `${orgName}/${type}` : orgName;\n    \n    const result = await cloudinary.search\n      .expression(`folder:${folderPath}/*`)\n      .with_field('tags')\n      .max_results(500)\n      .execute();\n    \n    const images = await Promise.all(result.resources.map(async (resource: any) => {\n      // Try to get scene data from associated raw file\n      let sceneData = null;\n      \n      // Check for associated scene file (named as {public_id}_scene)\n      const sceneFileName = `${resource.public_id}_scene`;\n      try {\n        const sceneResource = await cloudinary.api.resource(sceneFileName, { resource_type: 'raw' });\n        // Fetch the actual content\n        const sceneResponse = await fetch(sceneResource.secure_url);\n        if (sceneResponse.ok) {\n          sceneData = await sceneResponse.text();\n        }\n      } catch (e) {\n        // Scene file doesn't exist, check context as fallback\n        if (resource.context && resource.context.custom && resource.context.custom.sceneData) {\n          sceneData = resource.context.custom.sceneData;\n        }\n      }\n      \n      return {\n        id: resource.public_id,\n        url: resource.secure_url,\n        thumbnail: cloudinary.url(resource.public_id, {\n          width: 200,\n          height: 200,\n          crop: 'fill',\n          quality: 'auto'\n        }),\n        format: resource.format,\n        width: resource.width,\n        height: resource.height,\n        createdAt: resource.created_at,\n        name: resource.public_id.split('/').pop(),\n        sceneData: sceneData\n      };\n    }));\n    \n    res.json({ images, count: images.length });\n  } catch (error: any) {\n    console.error('Error fetching organization images:', error);\n    res.status(500).json({ error: 'Failed to fetch images', message: error.message });\n  }\n}\n\n"],"names":[],"mappings":";;;;AACA;;AAEe,eAAe,QAC5B,GAAmB,EACnB,GAAoB;IAEpB,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,IAAI,SAAS,CAAC,SAAS;YAAC;SAAM;QAC9B,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,IAAI,MAAM,CAAC,YAAY,CAAC;IAC/D;IAEA,IAAI;QACF,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,KAAK;QAC7B,MAAM,EAAE,IAAI,EAAE,GAAG,IAAI,KAAK,EAAE,4BAA4B;QAExD,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU;YAC3C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAgC;QACvE;QAEA,+CAA+C;QAC/C,0CAA0C;QAC1C,MAAM,aAAa,OAAO,GAAG,QAAQ,CAAC,EAAE,MAAM,GAAG;QAEjD,MAAM,SAAS,MAAM,gIAAU,CAAC,MAAM,CACnC,UAAU,CAAC,CAAC,OAAO,EAAE,WAAW,EAAE,CAAC,EACnC,UAAU,CAAC,QACX,WAAW,CAAC,KACZ,OAAO;QAEV,MAAM,SAAS,MAAM,QAAQ,GAAG,CAAC,OAAO,SAAS,CAAC,GAAG,CAAC,OAAO;YAC3D,iDAAiD;YACjD,IAAI,YAAY;YAEhB,+DAA+D;YAC/D,MAAM,gBAAgB,GAAG,SAAS,SAAS,CAAC,MAAM,CAAC;YACnD,IAAI;gBACF,MAAM,gBAAgB,MAAM,gIAAU,CAAC,GAAG,CAAC,QAAQ,CAAC,eAAe;oBAAE,eAAe;gBAAM;gBAC1F,2BAA2B;gBAC3B,MAAM,gBAAgB,MAAM,MAAM,cAAc,UAAU;gBAC1D,IAAI,cAAc,EAAE,EAAE;oBACpB,YAAY,MAAM,cAAc,IAAI;gBACtC;YACF,EAAE,OAAO,GAAG;gBACV,sDAAsD;gBACtD,IAAI,SAAS,OAAO,IAAI,SAAS,OAAO,CAAC,MAAM,IAAI,SAAS,OAAO,CAAC,MAAM,CAAC,SAAS,EAAE;oBACpF,YAAY,SAAS,OAAO,CAAC,MAAM,CAAC,SAAS;gBAC/C;YACF;YAEA,OAAO;gBACL,IAAI,SAAS,SAAS;gBACtB,KAAK,SAAS,UAAU;gBACxB,WAAW,gIAAU,CAAC,GAAG,CAAC,SAAS,SAAS,EAAE;oBAC5C,OAAO;oBACP,QAAQ;oBACR,MAAM;oBACN,SAAS;gBACX;gBACA,QAAQ,SAAS,MAAM;gBACvB,OAAO,SAAS,KAAK;gBACrB,QAAQ,SAAS,MAAM;gBACvB,WAAW,SAAS,UAAU;gBAC9B,MAAM,SAAS,SAAS,CAAC,KAAK,CAAC,KAAK,GAAG;gBACvC,WAAW;YACb;QACF;QAEA,IAAI,IAAI,CAAC;YAAE;YAAQ,OAAO,OAAO,MAAM;QAAC;IAC1C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,uCAAuC;QACrD,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;YAA0B,SAAS,MAAM,OAAO;QAAC;IACjF;AACF","debugId":null}}]
}