{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/IMAGE%20EDITOR/Image_Editor/backend/lib/cloudinary.ts"],"sourcesContent":["import { v2 as cloudinary } from 'cloudinary';\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET\n});\n\nexport default cloudinary;\n\n// Helper function to create folder structure in Cloudinary\nexport async function createCloudinaryFolder(folderPath: string) {\n  // Cloudinary creates folders automatically when you upload to them\n  // We'll upload a small transparent 1x1 PNG placeholder\n  const placeholderImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';\n  \n  try {\n    const result = await cloudinary.uploader.upload(placeholderImage, {\n      folder: folderPath,\n      public_id: '.folder_marker',\n      overwrite: true,\n      invalidate: true,\n      resource_type: 'image'\n    });\n    return { success: true, public_id: result.public_id };\n  } catch (error: any) {\n    console.error(`Error creating folder ${folderPath}:`, error);\n    return { success: false, error: error.message };\n  }\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,uBAAuB;AACvB,mHAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;uCAEe,mHAAU;AAGlB,eAAe,uBAAuB,UAAkB;IAC7D,mEAAmE;IACnE,uDAAuD;IACvD,MAAM,mBAAmB;IAEzB,IAAI;QACF,MAAM,SAAS,MAAM,mHAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,kBAAkB;YAChE,QAAQ;YACR,WAAW;YACX,WAAW;YACX,YAAY;YACZ,eAAe;QACjB;QACA,OAAO;YAAE,SAAS;YAAM,WAAW,OAAO,SAAS;QAAC;IACtD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,WAAW,CAAC,CAAC,EAAE;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;AACF","debugId":null}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/IMAGE%20EDITOR/Image_Editor/backend/pages/api/organization/%5BorgName%5D/image/%5BimageId%5D.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport cloudinary from '@/lib/cloudinary';\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  // Handle CORS preflight\n  if (req.method === 'OPTIONS') {\n    res.setHeader('Access-Control-Allow-Origin', '*');\n    res.setHeader('Access-Control-Allow-Methods', 'DELETE, OPTIONS');\n    res.setHeader('Access-Control-Allow-Headers', 'Content-Type');\n    res.status(200).end();\n    return;\n  }\n\n  // Set CORS headers for actual request\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.setHeader('Access-Control-Allow-Methods', 'DELETE, OPTIONS');\n  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');\n\n  if (req.method === 'GET') {\n    try {\n      const { imageId } = req.query;\n      \n      if (!imageId || typeof imageId !== 'string') {\n        return res.status(400).json({ error: 'Image ID is required' });\n      }\n      \n      const result = await cloudinary.api.resource(imageId);\n      \n      res.json({\n        id: result.public_id,\n        url: result.secure_url,\n        format: result.format,\n        width: result.width,\n        height: result.height\n      });\n    } catch (error: any) {\n      console.error('Error fetching image:', error);\n      res.status(500).json({ error: 'Failed to fetch image', message: error.message });\n    }\n  } else if (req.method === 'DELETE') {\n    try {\n      const { imageId } = req.query;\n      \n      if (!imageId || typeof imageId !== 'string') {\n        return res.status(400).json({ error: 'Image ID is required' });\n      }\n      \n      // Delete the image from Cloudinary\n      const deleteResult = await cloudinary.uploader.destroy(imageId);\n      \n      // Also try to delete associated scene file if it exists\n      const sceneFileName = `${imageId}_scene`;\n      try {\n        await cloudinary.uploader.destroy(sceneFileName, { resource_type: 'raw' });\n      } catch (sceneError) {\n        // Scene file might not exist, that's okay\n        console.log('Scene file not found or already deleted:', sceneFileName);\n      }\n      \n      if (deleteResult.result === 'ok' || deleteResult.result === 'not found') {\n        res.json({\n          success: true,\n          message: 'Image deleted successfully',\n          id: imageId\n        });\n      } else {\n        res.status(500).json({\n          error: 'Failed to delete image',\n          result: deleteResult.result\n        });\n      }\n    } catch (error: any) {\n      console.error('Error deleting image:', error);\n      res.status(500).json({ error: 'Failed to delete image', message: error.message });\n    }\n  } else {\n    res.setHeader('Allow', ['GET', 'DELETE', 'OPTIONS']);\n    return res.status(405).end(`Method ${req.method} Not Allowed`);\n  }\n}\n"],"names":[],"mappings":";;;;AACA;;AAEe,eAAe,QAC5B,GAAmB,EACnB,GAAoB;IAEpB,wBAAwB;IACxB,IAAI,IAAI,MAAM,KAAK,WAAW;QAC5B,IAAI,SAAS,CAAC,+BAA+B;QAC7C,IAAI,SAAS,CAAC,gCAAgC;QAC9C,IAAI,SAAS,CAAC,gCAAgC;QAC9C,IAAI,MAAM,CAAC,KAAK,GAAG;QACnB;IACF;IAEA,sCAAsC;IACtC,IAAI,SAAS,CAAC,+BAA+B;IAC7C,IAAI,SAAS,CAAC,gCAAgC;IAC9C,IAAI,SAAS,CAAC,gCAAgC;IAE9C,IAAI,IAAI,MAAM,KAAK,OAAO;QACxB,IAAI;YACF,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,KAAK;YAE7B,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU;gBAC3C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,OAAO;gBAAuB;YAC9D;YAEA,MAAM,SAAS,MAAM,gIAAU,CAAC,GAAG,CAAC,QAAQ,CAAC;YAE7C,IAAI,IAAI,CAAC;gBACP,IAAI,OAAO,SAAS;gBACpB,KAAK,OAAO,UAAU;gBACtB,QAAQ,OAAO,MAAM;gBACrB,OAAO,OAAO,KAAK;gBACnB,QAAQ,OAAO,MAAM;YACvB;QACF,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,yBAAyB;YACvC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;gBAAyB,SAAS,MAAM,OAAO;YAAC;QAChF;IACF,OAAO,IAAI,IAAI,MAAM,KAAK,UAAU;QAClC,IAAI;YACF,MAAM,EAAE,OAAO,EAAE,GAAG,IAAI,KAAK;YAE7B,IAAI,CAAC,WAAW,OAAO,YAAY,UAAU;gBAC3C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,OAAO;gBAAuB;YAC9D;YAEA,mCAAmC;YACnC,MAAM,eAAe,MAAM,gIAAU,CAAC,QAAQ,CAAC,OAAO,CAAC;YAEvD,wDAAwD;YACxD,MAAM,gBAAgB,GAAG,QAAQ,MAAM,CAAC;YACxC,IAAI;gBACF,MAAM,gIAAU,CAAC,QAAQ,CAAC,OAAO,CAAC,eAAe;oBAAE,eAAe;gBAAM;YAC1E,EAAE,OAAO,YAAY;gBACnB,0CAA0C;gBAC1C,QAAQ,GAAG,CAAC,4CAA4C;YAC1D;YAEA,IAAI,aAAa,MAAM,KAAK,QAAQ,aAAa,MAAM,KAAK,aAAa;gBACvE,IAAI,IAAI,CAAC;oBACP,SAAS;oBACT,SAAS;oBACT,IAAI;gBACN;YACF,OAAO;gBACL,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBACnB,OAAO;oBACP,QAAQ,aAAa,MAAM;gBAC7B;YACF;QACF,EAAE,OAAO,OAAY;YACnB,QAAQ,KAAK,CAAC,yBAAyB;YACvC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;gBAA0B,SAAS,MAAM,OAAO;YAAC;QACjF;IACF,OAAO;QACL,IAAI,SAAS,CAAC,SAAS;YAAC;YAAO;YAAU;SAAU;QACnD,OAAO,IAAI,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,IAAI,MAAM,CAAC,YAAY,CAAC;IAC/D;AACF","debugId":null}}]
}