{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/IMAGE%20EDITOR/Image_Editor/backend/lib/cloudinary.ts"],"sourcesContent":["import { v2 as cloudinary } from 'cloudinary';\n\n// Configure Cloudinary\ncloudinary.config({\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET\n});\n\nexport default cloudinary;\n\n// Helper function to create folder structure in Cloudinary\nexport async function createCloudinaryFolder(folderPath: string) {\n  // Cloudinary creates folders automatically when you upload to them\n  // We'll upload a small transparent 1x1 PNG placeholder\n  const placeholderImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';\n  \n  try {\n    const result = await cloudinary.uploader.upload(placeholderImage, {\n      folder: folderPath,\n      public_id: '.folder_marker',\n      overwrite: true,\n      invalidate: true,\n      resource_type: 'image'\n    });\n    return { success: true, public_id: result.public_id };\n  } catch (error: any) {\n    console.error(`Error creating folder ${folderPath}:`, error);\n    return { success: false, error: error.message };\n  }\n}\n\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,uBAAuB;AACvB,mHAAU,CAAC,MAAM,CAAC;IAChB,YAAY,QAAQ,GAAG,CAAC,qBAAqB;IAC7C,SAAS,QAAQ,GAAG,CAAC,kBAAkB;IACvC,YAAY,QAAQ,GAAG,CAAC,qBAAqB;AAC/C;uCAEe,mHAAU;AAGlB,eAAe,uBAAuB,UAAkB;IAC7D,mEAAmE;IACnE,uDAAuD;IACvD,MAAM,mBAAmB;IAEzB,IAAI;QACF,MAAM,SAAS,MAAM,mHAAU,CAAC,QAAQ,CAAC,MAAM,CAAC,kBAAkB;YAChE,QAAQ;YACR,WAAW;YACX,WAAW;YACX,YAAY;YACZ,eAAe;QACjB;QACA,OAAO;YAAE,SAAS;YAAM,WAAW,OAAO,SAAS;QAAC;IACtD,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,WAAW,CAAC,CAAC,EAAE;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAChD;AACF","debugId":null}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///Users/mac/Desktop/IMAGE%20EDITOR/Image_Editor/backend/pages/api/organization/%5BorgName%5D/create.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next';\nimport cloudinary from '@/lib/cloudinary';\nimport { createCloudinaryFolder } from '@/lib/cloudinary';\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  // Handle CORS preflight\n  if (req.method === 'OPTIONS') {\n    res.status(200).end();\n    return;\n  }\n\n  if (req.method !== 'POST') {\n    res.setHeader('Allow', ['POST', 'OPTIONS']);\n    return res.status(405).end(`Method ${req.method} Not Allowed`);\n  }\n\n  try {\n    const { orgName } = req.query;\n    \n    if (!orgName || typeof orgName !== 'string') {\n      return res.status(400).json({ error: 'Organization name is required' });\n    }\n    \n    // Validate organization name\n    if (orgName.trim().length === 0) {\n      return res.status(400).json({ error: 'Organization name is required' });\n    }\n    \n    // Sanitize organization name (remove special characters that might cause issues)\n    const sanitizedOrgName = orgName.trim().replace(/[^a-zA-Z0-9_-]/g, '_');\n    \n    if (sanitizedOrgName !== orgName.trim()) {\n      return res.status(400).json({ \n        error: 'Organization name contains invalid characters. Use only letters, numbers, underscores, and hyphens.',\n        suggestedName: sanitizedOrgName\n      });\n    }\n    \n    // Check if organization already exists\n    let exists = false;\n    try {\n      const checkResult = await cloudinary.search\n        .expression(`folder:${orgName}/*`)\n        .max_results(1)\n        .execute();\n      \n      if (checkResult.total_count > 0) {\n        exists = true;\n      }\n    } catch (searchError) {\n      // Folder doesn't exist, continue with creation\n    }\n    \n    // Also check root folders\n    if (!exists) {\n      try {\n        const rootFolders = await cloudinary.api.root_folders();\n        if (rootFolders && rootFolders.folders) {\n          const folderNames = rootFolders.folders.map((f: any) => f.name || f.path);\n          if (folderNames.includes(orgName)) {\n            exists = true;\n          }\n        }\n      } catch (rootError) {\n        // Continue with creation\n      }\n    }\n    \n    if (exists) {\n      return res.status(400).json({ \n        error: 'Organization already exists',\n        exists: true,\n        organizationName: orgName \n      });\n    }\n    \n    // Create folder structure in Cloudinary\n    // Cloudinary creates folders when you upload files to them\n    const foldersToCreate = [\n      orgName,                    // Main organization folder\n      `${orgName}/editor`,        // Editor subfolder\n      `${orgName}/mindmapping`    // Mind mapping subfolder\n    ];\n    \n    const creationResults = [];\n    let allSuccessful = true;\n    \n    // Create each folder by uploading a placeholder\n    for (const folderPath of foldersToCreate) {\n      const result = await createCloudinaryFolder(folderPath);\n      creationResults.push({\n        folder: folderPath,\n        success: result.success,\n        error: result.error\n      });\n      \n      if (!result.success) {\n        allSuccessful = false;\n      }\n    }\n    \n    // Verify folders were created by checking if they exist\n    let verificationSuccess = false;\n    try {\n      // Wait a moment for Cloudinary to process\n      await new Promise(resolve => setTimeout(resolve, 1000));\n      \n      // Try to list subfolders of the organization\n      const subFolders = await cloudinary.api.sub_folders(orgName);\n      if (subFolders && subFolders.folders) {\n        const folderNames = subFolders.folders.map((f: any) => f.name || f.path);\n        verificationSuccess = folderNames.length > 0 || true; // At least main folder exists\n      }\n    } catch (verifyError) {\n      // Even if verification fails, folders might still be created\n      // They'll be created when first image is uploaded\n      verificationSuccess = true; // Assume success\n    }\n    \n    if (allSuccessful || verificationSuccess) {\n      res.json({ \n        success: true,\n        message: 'Organization folder structure created successfully in Cloudinary',\n        organizationName: orgName,\n        foldersCreated: foldersToCreate,\n        details: creationResults\n      });\n    } else {\n      res.status(500).json({ \n        error: 'Failed to create some folders',\n        organizationName: orgName,\n        details: creationResults\n      });\n    }\n  } catch (error: any) {\n    console.error('Error creating organization:', error);\n    res.status(500).json({ \n      error: 'Failed to create organization', \n      message: error.message \n    });\n  }\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}